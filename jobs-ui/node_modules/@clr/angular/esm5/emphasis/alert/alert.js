import * as tslib_1 from "tslib";
/*
 * Copyright (c) 2016-2019 VMware, Inc. All Rights Reserved.
 * This software is released under MIT license.
 * The full license information can be found in LICENSE in the root directory of this project.
 */
import { ChangeDetectorRef, ElementRef, Component, EventEmitter, Input, Optional, Output, ContentChildren, QueryList, } from '@angular/core';
// providers
import { AlertIconAndTypesService } from './providers/icon-and-types.service';
import { MultiAlertService } from './providers/multi-alert.service';
import { isBooleanAttributeSet } from '../../utils/component/is-boolean-attribute-set';
import { ClrCommonStringsService } from '../../utils/i18n/common-strings.service';
import { AriaLiveService, AriaLivePoliteness } from '../../utils/a11y/aria-live.service';
import { ClrAlertText } from './alert-text';
var ClrAlert = /** @class */ (function () {
    function ClrAlert(iconService, cdr, multiAlertService, commonStrings, ariaLiveService) {
        this.iconService = iconService;
        this.cdr = cdr;
        this.multiAlertService = multiAlertService;
        this.commonStrings = commonStrings;
        this.ariaLiveService = ariaLiveService;
        this.isSmall = false;
        this.closable = true;
        this.isAppLevel = false;
        // Aria
        this.clrCloseButtonAriaLabel = this.commonStrings.keys.alertCloseButtonAriaLabel;
        this._closed = false;
        this._closedChanged = new EventEmitter(false);
        /**
         * clrPolite is not used in the code. Is here just to provide
         * code complition and also mark component what type AriaLive
         * will be used.
         */
        this.polite = true;
        this.previouslyHidden = false;
        this.hidden = false;
    }
    ClrAlert.prototype.ngAfterViewInit = function () {
        // Announce the first time the alert is render if it is not hidden
        this.announceAriaLiveMessage();
    };
    Object.defineProperty(ClrAlert.prototype, "alertType", {
        get: function () {
            return this.iconService.alertType;
        },
        set: function (val) {
            this.iconService.alertType = val;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ClrAlert.prototype, "ariaLive", {
        /**
         * There is an order on how the attributes will take effect.
         * Assertive, Off, Polite.
         *
         * Polite is default if non is passed.
         *
         * In the case of setting all of them to true. Assertive will be used.
         *
         */
        get: function () {
            if (isBooleanAttributeSet(this.assertive)) {
                return AriaLivePoliteness.assertive;
            }
            if (isBooleanAttributeSet(this.off)) {
                return AriaLivePoliteness.off;
            }
            return AriaLivePoliteness.polite;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ClrAlert.prototype, "alertIconShape", {
        set: function (value) {
            this.iconService.alertIconShape = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ClrAlert.prototype, "alertClass", {
        get: function () {
            return this.iconService.iconInfoFromType(this.iconService.alertType).cssClass;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * This handle the find what content to be annonced withing the aria-live container
     * alerts that are hidden will be ignored.
     *
     * @remark
     * We depend on the ClrAlertText Directive to find and parse the alert messages.
     * Also this require the HTML markup for the alert to be
     * ```html
     * <div class="alert" role="alert">
     *    <div class="alert-items">
     *        <div class="alert-item static">
     *            <span class="alert-text">
     *                 ...
     *            </span>
     *        </div>
     *    </div>
     * </div>
     * ```
     */
    ClrAlert.prototype.announceAriaLiveMessage = function () {
        if (!this.isHidden && this.alertTexts.length) {
            var message = this.alertTexts.map(function (alertText) { return alertText.nativeElement.textContent; }).join(' ');
            // Don't call announce when there is nothing to say
            if (message) {
                this.ariaLiveService.announce(message, this.ariaLive);
            }
        }
    };
    ClrAlert.prototype.detectChangesIfNeeded = function () {
        if (this.previouslyHidden !== this.hidden) {
            this.previouslyHidden = this.hidden;
            this.cdr.detectChanges();
            // when alert hidden state change we could check and try to announce it.
            this.announceAriaLiveMessage();
        }
    };
    Object.defineProperty(ClrAlert.prototype, "isHidden", {
        get: function () {
            if (this.multiAlertService) {
                // change detection issue in production mode causes currentAlert to be undefined when only the first alert exists
                // https://github.com/vmware/clarity/issues/2430
                if (this.multiAlertService.currentAlert === this || this.multiAlertService.count === 0) {
                    if (this.hidden === true) {
                        this.previouslyHidden = true;
                        this.hidden = false;
                    }
                }
                else if (this.hidden === false) {
                    this.previouslyHidden = false;
                    this.hidden = true;
                }
                this.detectChangesIfNeeded();
            }
            return this.hidden;
        },
        enumerable: true,
        configurable: true
    });
    ClrAlert.prototype.close = function () {
        if (!this.closable) {
            return;
        }
        this._closed = true;
        if (this.multiAlertService) {
            this.multiAlertService.close();
        }
        this._closedChanged.emit(true);
    };
    ClrAlert.prototype.open = function () {
        this._closed = false;
        this._closedChanged.emit(false);
    };
    tslib_1.__decorate([
        Input('clrAlertSizeSmall'),
        tslib_1.__metadata("design:type", Boolean)
    ], ClrAlert.prototype, "isSmall", void 0);
    tslib_1.__decorate([
        Input('clrAlertClosable'),
        tslib_1.__metadata("design:type", Boolean)
    ], ClrAlert.prototype, "closable", void 0);
    tslib_1.__decorate([
        Input('clrAlertAppLevel'),
        tslib_1.__metadata("design:type", Boolean)
    ], ClrAlert.prototype, "isAppLevel", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], ClrAlert.prototype, "clrCloseButtonAriaLabel", void 0);
    tslib_1.__decorate([
        Input('clrAlertClosed'),
        tslib_1.__metadata("design:type", Boolean)
    ], ClrAlert.prototype, "_closed", void 0);
    tslib_1.__decorate([
        Output('clrAlertClosedChange'),
        tslib_1.__metadata("design:type", EventEmitter)
    ], ClrAlert.prototype, "_closedChanged", void 0);
    tslib_1.__decorate([
        Input('clrAlertType'),
        tslib_1.__metadata("design:type", String),
        tslib_1.__metadata("design:paramtypes", [String])
    ], ClrAlert.prototype, "alertType", null);
    tslib_1.__decorate([
        Input('clrPolite'),
        tslib_1.__metadata("design:type", Boolean)
    ], ClrAlert.prototype, "polite", void 0);
    tslib_1.__decorate([
        Input('clrAssertive'),
        tslib_1.__metadata("design:type", Boolean)
    ], ClrAlert.prototype, "assertive", void 0);
    tslib_1.__decorate([
        Input('clrOff'),
        tslib_1.__metadata("design:type", Boolean)
    ], ClrAlert.prototype, "off", void 0);
    tslib_1.__decorate([
        Input('clrAlertIcon'),
        tslib_1.__metadata("design:type", String),
        tslib_1.__metadata("design:paramtypes", [String])
    ], ClrAlert.prototype, "alertIconShape", null);
    tslib_1.__decorate([
        ContentChildren(ClrAlertText, { descendants: true, read: ElementRef }),
        tslib_1.__metadata("design:type", QueryList)
    ], ClrAlert.prototype, "alertTexts", void 0);
    ClrAlert = tslib_1.__decorate([
        Component({
            selector: 'clr-alert',
            providers: [AlertIconAndTypesService, AriaLiveService],
            template: "<!--\n  ~ Copyright (c) 2016-2019 VMware, Inc. All Rights Reserved.\n  ~ This software is released under MIT license.\n  ~ The full license information can be found in LICENSE in the root directory of this project.\n  -->\n\n<div\n    *ngIf=\"!_closed\"\n    class=\"alert\"\n    [ngClass]=\"alertClass\"\n    [class.alert-hidden]=\"isHidden\"\n    [class.alert-sm]=\"isSmall\"\n    [class.alert-app-level]=\"isAppLevel\">\n    <div class=\"alert-items\">\n        <ng-content></ng-content>\n    </div>\n    <button\n        type=\"button\"\n        class=\"close\"\n        *ngIf=\"closable\"\n        (click)=\"close()\"\n        [attr.aria-label]=\"clrCloseButtonAriaLabel\"\n        >\n        <clr-icon shape=\"close\"></clr-icon>\n    </button>\n</div>\n",
            styles: [':host { display: block; }']
        }),
        tslib_1.__param(2, Optional()),
        tslib_1.__metadata("design:paramtypes", [AlertIconAndTypesService,
            ChangeDetectorRef,
            MultiAlertService,
            ClrCommonStringsService,
            AriaLiveService])
    ], ClrAlert);
    return ClrAlert;
}());
export { ClrAlert };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWxlcnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AY2xyL2FuZ3VsYXIvIiwic291cmNlcyI6WyJlbXBoYXNpcy9hbGVydC9hbGVydC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRztBQUNILE9BQU8sRUFDTCxpQkFBaUIsRUFDakIsVUFBVSxFQUNWLFNBQVMsRUFDVCxZQUFZLEVBQ1osS0FBSyxFQUNMLFFBQVEsRUFDUixNQUFNLEVBRU4sZUFBZSxFQUNmLFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQUV2QixZQUFZO0FBQ1osT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDOUUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDcEUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sZ0RBQWdELENBQUM7QUFDdkYsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0seUNBQXlDLENBQUM7QUFDbEYsT0FBTyxFQUFFLGVBQWUsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3pGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFRNUM7SUFDRSxrQkFDUyxXQUFxQyxFQUNyQyxHQUFzQixFQUNWLGlCQUFvQyxFQUNoRCxhQUFzQyxFQUNyQyxlQUFnQztRQUpqQyxnQkFBVyxHQUFYLFdBQVcsQ0FBMEI7UUFDckMsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFDVixzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBQ2hELGtCQUFhLEdBQWIsYUFBYSxDQUF5QjtRQUNyQyxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7UUFRZCxZQUFPLEdBQVksS0FBSyxDQUFDO1FBQzFCLGFBQVEsR0FBWSxJQUFJLENBQUM7UUFDekIsZUFBVSxHQUFZLEtBQUssQ0FBQztRQUV2RCxPQUFPO1FBQ0UsNEJBQXVCLEdBQVcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMseUJB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Q0FBQzs7NENBQXdCO0lBQ3BCO1FBQXRCLEtBQUssQ0FBQyxjQUFjLENBQUM7OytDQUFvQjtJQUN6QjtRQUFoQixLQUFLLENBQUMsUUFBUSxDQUFDOzt5Q0FBYztJQXFCOUI7UUFEQyxLQUFLLENBQUMsY0FBYyxDQUFDOzs7a0RBR3JCO0lBT0Q7UUFEQyxlQUFlLENBQUMsWUFBWSxFQUFFLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLENBQUM7MENBQzNELFNBQVM7Z0RBQWE7SUF0RXZCLFFBQVE7UUFOcEIsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLFdBQVc7WUFDckIsU0FBUyxFQUFFLENBQUMsd0JBQXdCLEVBQUUsZUFBZSxDQUFDO1lBQ3RELG93QkFBMkI7cUJBQ2xCLDJCQUEyQjtTQUNyQyxDQUFDO1FBS0csbUJBQUEsUUFBUSxFQUFFLENBQUE7aURBRlMsd0JBQXdCO1lBQ2hDLGlCQUFpQjtZQUNTLGlCQUFpQjtZQUNqQyx1QkFBdUI7WUFDcEIsZUFBZTtPQU4vQixRQUFRLENBa0pwQjtJQUFELGVBQUM7Q0FBQSxBQWxKRCxJQWtKQztTQWxKWSxRQUFRIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAoYykgMjAxNi0yMDE5IFZNd2FyZSwgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICogVGhpcyBzb2Z0d2FyZSBpcyByZWxlYXNlZCB1bmRlciBNSVQgbGljZW5zZS5cbiAqIFRoZSBmdWxsIGxpY2Vuc2UgaW5mb3JtYXRpb24gY2FuIGJlIGZvdW5kIGluIExJQ0VOU0UgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgcHJvamVjdC5cbiAqL1xuaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIEVsZW1lbnRSZWYsXG4gIENvbXBvbmVudCxcbiAgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCxcbiAgT3B0aW9uYWwsXG4gIE91dHB1dCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ29udGVudENoaWxkcmVuLFxuICBRdWVyeUxpc3QsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG4vLyBwcm92aWRlcnNcbmltcG9ydCB7IEFsZXJ0SWNvbkFuZFR5cGVzU2VydmljZSB9IGZyb20gJy4vcHJvdmlkZXJzL2ljb24tYW5kLXR5cGVzLnNlcnZpY2UnO1xuaW1wb3J0IHsgTXVsdGlBbGVydFNlcnZpY2UgfSBmcm9tICcuL3Byb3ZpZGVycy9tdWx0aS1hbGVydC5zZXJ2aWNlJztcbmltcG9ydCB7IGlzQm9vbGVhbkF0dHJpYnV0ZVNldCB9IGZyb20gJy4uLy4uL3V0aWxzL2NvbXBvbmVudC9pcy1ib29sZWFuLWF0dHJpYnV0ZS1zZXQnO1xuaW1wb3J0IHsgQ2xyQ29tbW9uU3RyaW5nc1NlcnZpY2UgfSBmcm9tICcuLi8uLi91dGlscy9pMThuL2NvbW1vbi1zdHJpbmdzLnNlcnZpY2UnO1xuaW1wb3J0IHsgQXJpYUxpdmVTZXJ2aWNlLCBBcmlhTGl2ZVBvbGl0ZW5lc3MgfSBmcm9tICcuLi8uLi91dGlscy9hMTF5L2FyaWEtbGl2ZS5zZXJ2aWNlJztcbmltcG9ydCB7IENsckFsZXJ0VGV4dCB9IGZyb20gJy4vYWxlcnQtdGV4dCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2Nsci1hbGVydCcsXG4gIHByb3ZpZGVyczogW0FsZXJ0SWNvbkFuZFR5cGVzU2VydmljZSwgQXJpYUxpdmVTZXJ2aWNlXSxcbiAgdGVtcGxhdGVVcmw6ICcuL2FsZXJ0Lmh0bWwnLFxuICBzdHlsZXM6IFsnOmhvc3QgeyBkaXNwbGF5OiBibG9jazsgfSddLFxufSlcbmV4cG9ydCBjbGFzcyBDbHJBbGVydCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgaWNvblNlcnZpY2U6IEFsZXJ0SWNvbkFuZFR5cGVzU2VydmljZSxcbiAgICBwdWJsaWMgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBAT3B0aW9uYWwoKSBwdWJsaWMgbXVsdGlBbGVydFNlcnZpY2U6IE11bHRpQWxlcnRTZXJ2aWNlLFxuICAgIHB1YmxpYyBjb21tb25TdHJpbmdzOiBDbHJDb21tb25TdHJpbmdzU2VydmljZSxcbiAgICBwcml2YXRlIGFyaWFMaXZlU2VydmljZTogQXJpYUxpdmVTZXJ2aWNlXG4gICkge31cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgLy8gQW5ub3VuY2UgdGhlIGZpcnN0IHRpbWUgdGhlIGFsZXJ0IGlzIHJlbmRlciBpZiBpdCBpcyBub3QgaGlkZGVuXG4gICAgdGhpcy5hbm5vdW5jZUFyaWFMaXZlTWVzc2FnZSgpO1xuICB9XG5cbiAgQElucHV0KCdjbHJBbGVydFNpemVTbWFsbCcpIGlzU21hbGw6IGJvb2xlYW4gPSBmYWxzZTtcbiAgQElucHV0KCdjbHJBbGVydENsb3NhYmxlJykgY2xvc2FibGU6IGJvb2xlYW4gPSB0cnVlO1xuICBASW5wdXQoJ2NsckFsZXJ0QXBwTGV2ZWwnKSBpc0FwcExldmVsOiBib29sZWFuID0gZmFsc2U7XG5cbiAgLy8gQXJpYVxuICBASW5wdXQoKSBjbHJDbG9zZUJ1dHRvbkFyaWFMYWJlbDogc3RyaW5nID0gdGhpcy5jb21tb25TdHJpbmdzLmtleXMuYWxlcnRDbG9zZUJ1dHRvbkFyaWFMYWJlbDtcblxuICBASW5wdXQoJ2NsckFsZXJ0Q2xvc2VkJykgX2Nsb3NlZDogYm9vbGVhbiA9IGZhbHNlO1xuICBAT3V0cHV0KCdjbHJBbGVydENsb3NlZENoYW5nZScpIF9jbG9zZWRDaGFuZ2VkOiBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4gPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KGZhbHNlKTtcblxuICBASW5wdXQoJ2NsckFsZXJ0VHlwZScpXG4gIHNldCBhbGVydFR5cGUodmFsOiBzdHJpbmcpIHtcbiAgICB0aGlzLmljb25TZXJ2aWNlLmFsZXJ0VHlwZSA9IHZhbDtcbiAgfVxuXG4gIGdldCBhbGVydFR5cGUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5pY29uU2VydmljZS5hbGVydFR5cGU7XG4gIH1cblxuICAvKipcbiAgICogY2xyUG9saXRlIGlzIG5vdCB1c2VkIGluIHRoZSBjb2RlLiBJcyBoZXJlIGp1c3QgdG8gcHJvdmlkZVxuICAgKiBjb2RlIGNvbXBsaXRpb24gYW5kIGFsc28gbWFyayBjb21wb25lbnQgd2hhdCB0eXBlIEFyaWFMaXZlXG4gICAqIHdpbGwgYmUgdXNlZC5cbiAgICovXG4gIEBJbnB1dCgnY2xyUG9saXRlJykgcG9saXRlOiBib29sZWFuID0gdHJ1ZTtcbiAgQElucHV0KCdjbHJBc3NlcnRpdmUnKSBhc3NlcnRpdmU6IGJvb2xlYW47XG4gIEBJbnB1dCgnY2xyT2ZmJykgb2ZmOiBib29sZWFuO1xuICAvKipcbiAgICogVGhlcmUgaXMgYW4gb3JkZXIgb24gaG93IHRoZSBhdHRyaWJ1dGVzIHdpbGwgdGFrZSBlZmZlY3QuXG4gICAqIEFzc2VydGl2ZSwgT2ZmLCBQb2xpdGUuXG4gICAqXG4gICAqIFBvbGl0ZSBpcyBkZWZhdWx0IGlmIG5vbiBpcyBwYXNzZWQuXG4gICAqXG4gICAqIEluIHRoZSBjYXNlIG9mIHNldHRpbmcgYWxsIG9mIHRoZW0gdG8gdHJ1ZS4gQXNzZXJ0aXZlIHdpbGwgYmUgdXNlZC5cbiAgICpcbiAgICovXG4gIGdldCBhcmlhTGl2ZSgpOiBBcmlhTGl2ZVBvbGl0ZW5lc3Mge1xuICAgIGlmIChpc0Jvb2xlYW5BdHRyaWJ1dGVTZXQodGhpcy5hc3NlcnRpdmUpKSB7XG4gICAgICByZXR1cm4gQXJpYUxpdmVQb2xpdGVuZXNzLmFzc2VydGl2ZTtcbiAgICB9XG4gICAgaWYgKGlzQm9vbGVhbkF0dHJpYnV0ZVNldCh0aGlzLm9mZikpIHtcbiAgICAgIHJldHVybiBBcmlhTGl2ZVBvbGl0ZW5lc3Mub2ZmO1xuICAgIH1cbiAgICByZXR1cm4gQXJpYUxpdmVQb2xpdGVuZXNzLnBvbGl0ZTtcbiAgfVxuXG4gIEBJbnB1dCgnY2xyQWxlcnRJY29uJylcbiAgc2V0IGFsZXJ0SWNvblNoYXBlKHZhbHVlOiBzdHJpbmcpIHtcbiAgICB0aGlzLmljb25TZXJ2aWNlLmFsZXJ0SWNvblNoYXBlID0gdmFsdWU7XG4gIH1cblxuICBnZXQgYWxlcnRDbGFzcygpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmljb25TZXJ2aWNlLmljb25JbmZvRnJvbVR5cGUodGhpcy5pY29uU2VydmljZS5hbGVydFR5cGUpLmNzc0NsYXNzO1xuICB9XG5cbiAgQENvbnRlbnRDaGlsZHJlbihDbHJBbGVydFRleHQsIHsgZGVzY2VuZGFudHM6IHRydWUsIHJlYWQ6IEVsZW1lbnRSZWYgfSlcbiAgYWxlcnRUZXh0czogUXVlcnlMaXN0PEVsZW1lbnRSZWY+O1xuICAvKipcbiAgICogVGhpcyBoYW5kbGUgdGhlIGZpbmQgd2hhdCBjb250ZW50IHRvIGJlIGFubm9uY2VkIHdpdGhpbmcgdGhlIGFyaWEtbGl2ZSBjb250YWluZXJcbiAgICogYWxlcnRzIHRoYXQgYXJlIGhpZGRlbiB3aWxsIGJlIGlnbm9yZWQuXG4gICAqXG4gICAqIEByZW1hcmtcbiAgICogV2UgZGVwZW5kIG9uIHRoZSBDbHJBbGVydFRleHQgRGlyZWN0aXZlIHRvIGZpbmQgYW5kIHBhcnNlIHRoZSBhbGVydCBtZXNzYWdlcy5cbiAgICogQWxzbyB0aGlzIHJlcXVpcmUgdGhlIEhUTUwgbWFya3VwIGZvciB0aGUgYWxlcnQgdG8gYmVcbiAgICogYGBgaHRtbFxuICAgKiA8ZGl2IGNsYXNzPVwiYWxlcnRcIiByb2xlPVwiYWxlcnRcIj5cbiAgICogICAgPGRpdiBjbGFzcz1cImFsZXJ0LWl0ZW1zXCI+XG4gICAqICAgICAgICA8ZGl2IGNsYXNzPVwiYWxlcnQtaXRlbSBzdGF0aWNcIj5cbiAgICogICAgICAgICAgICA8c3BhbiBjbGFzcz1cImFsZXJ0LXRleHRcIj5cbiAgICogICAgICAgICAgICAgICAgIC4uLlxuICAgKiAgICAgICAgICAgIDwvc3Bhbj5cbiAgICogICAgICAgIDwvZGl2PlxuICAgKiAgICA8L2Rpdj5cbiAgICogPC9kaXY+XG4gICAqIGBgYFxuICAgKi9cbiAgcHJpdmF0ZSBhbm5vdW5jZUFyaWFMaXZlTWVzc2FnZSgpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuaXNIaWRkZW4gJiYgdGhpcy5hbGVydFRleHRzLmxlbmd0aCkge1xuICAgICAgY29uc3QgbWVzc2FnZSA9IHRoaXMuYWxlcnRUZXh0cy5tYXAoYWxlcnRUZXh0ID0+IGFsZXJ0VGV4dC5uYXRpdmVFbGVtZW50LnRleHRDb250ZW50KS5qb2luKCcgJyk7XG4gICAgICAvLyBEb24ndCBjYWxsIGFubm91bmNlIHdoZW4gdGhlcmUgaXMgbm90aGluZyB0byBzYXlcbiAgICAgIGlmIChtZXNzYWdlKSB7XG4gICAgICAgIHRoaXMuYXJpYUxpdmVTZXJ2aWNlLmFubm91bmNlKG1lc3NhZ2UsIHRoaXMuYXJpYUxpdmUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcHJldmlvdXNseUhpZGRlbiA9IGZhbHNlO1xuICBwcml2YXRlIGhpZGRlbiA9IGZhbHNlO1xuXG4gIHByaXZhdGUgZGV0ZWN0Q2hhbmdlc0lmTmVlZGVkKCkge1xuICAgIGlmICh0aGlzLnByZXZpb3VzbHlIaWRkZW4gIT09IHRoaXMuaGlkZGVuKSB7XG4gICAgICB0aGlzLnByZXZpb3VzbHlIaWRkZW4gPSB0aGlzLmhpZGRlbjtcbiAgICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIC8vIHdoZW4gYWxlcnQgaGlkZGVuIHN0YXRlIGNoYW5nZSB3ZSBjb3VsZCBjaGVjayBhbmQgdHJ5IHRvIGFubm91bmNlIGl0LlxuICAgICAgdGhpcy5hbm5vdW5jZUFyaWFMaXZlTWVzc2FnZSgpO1xuICAgIH1cbiAgfVxuXG4gIGdldCBpc0hpZGRlbigpIHtcbiAgICBpZiAodGhpcy5tdWx0aUFsZXJ0U2VydmljZSkge1xuICAgICAgLy8gY2hhbmdlIGRldGVjdGlvbiBpc3N1ZSBpbiBwcm9kdWN0aW9uIG1vZGUgY2F1c2VzIGN1cnJlbnRBbGVydCB0byBiZSB1bmRlZmluZWQgd2hlbiBvbmx5IHRoZSBmaXJzdCBhbGVydCBleGlzdHNcbiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS92bXdhcmUvY2xhcml0eS9pc3N1ZXMvMjQzMFxuICAgICAgaWYgKHRoaXMubXVsdGlBbGVydFNlcnZpY2UuY3VycmVudEFsZXJ0ID09PSB0aGlzIHx8IHRoaXMubXVsdGlBbGVydFNlcnZpY2UuY291bnQgPT09IDApIHtcbiAgICAgICAgaWYgKHRoaXMuaGlkZGVuID09PSB0cnVlKSB7XG4gICAgICAgICAgdGhpcy5wcmV2aW91c2x5SGlkZGVuID0gdHJ1ZTtcbiAgICAgICAgICB0aGlzLmhpZGRlbiA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuaGlkZGVuID09PSBmYWxzZSkge1xuICAgICAgICB0aGlzLnByZXZpb3VzbHlIaWRkZW4gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5oaWRkZW4gPSB0cnVlO1xuICAgICAgfVxuICAgICAgdGhpcy5kZXRlY3RDaGFuZ2VzSWZOZWVkZWQoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5oaWRkZW47XG4gIH1cblxuICBjbG9zZSgpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuY2xvc2FibGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5fY2xvc2VkID0gdHJ1ZTtcbiAgICBpZiAodGhpcy5tdWx0aUFsZXJ0U2VydmljZSkge1xuICAgICAgdGhpcy5tdWx0aUFsZXJ0U2VydmljZS5jbG9zZSgpO1xuICAgIH1cbiAgICB0aGlzLl9jbG9zZWRDaGFuZ2VkLmVtaXQodHJ1ZSk7XG4gIH1cblxuICBvcGVuKCk6IHZvaWQge1xuICAgIHRoaXMuX2Nsb3NlZCA9IGZhbHNlO1xuICAgIHRoaXMuX2Nsb3NlZENoYW5nZWQuZW1pdChmYWxzZSk7XG4gIH1cbn1cbiJdfQ==